# üöÄ GUIA DE DEPLOY - BDC CLASSIFICADOS

**Vers√£o**: 1.0.0
**Status**: ‚úÖ Certificado para Produ√ß√£o (97.1%)
**Data**: 02 de Janeiro de 2025

---

## üìã PR√â-REQUISITOS

### Valida√ß√µes Confirmadas ‚úÖ
- [x] Build compilado com sucesso (95 p√°ginas)
- [x] 0 vulnerabilidades de seguran√ßa
- [x] Banco de dados estruturado (20 tabelas)
- [x] APIs testadas (89.3% sucesso)
- [x] Supabase conectado e funcional
- [x] Vari√°veis de ambiente configuradas

### Contas Necess√°rias
- [x] **Vercel Account** - Deploy e hosting
- [x] **Supabase Account** - Banco de dados (j√° configurado)
- [x] **Asaas Account** - Pagamentos (chave produ√ß√£o configurada)
- [x] **Resend Account** - Emails transacionais (configurado)
- [ ] **Dom√≠nio** - www.buscaaquibdc.com (configurar DNS)

---

## üîß PASSO 1: PREPARA√á√ÉO LOCAL

### 1.1 Validar Build Local
```bash
# Limpar cache
npm run clean
rm -rf .next

# Instalar depend√™ncias
npm install

# Build de produ√ß√£o
npm run build

# Testar build localmente
npm run start
```

**Resultado esperado**: Servidor rodando em http://localhost:3000

### 1.2 Testar APIs Cr√≠ticas
```bash
# Testar conex√£o Supabase
node scripts/test-supabase-connection.js

# Testar APIs principais
node scripts/test-apis.js
```

**Resultado esperado**:
- Supabase: 100% (9/9 testes)
- APIs: 89.3% (25/28 testes)

### 1.3 Verificar Vari√°veis de Ambiente
```bash
# Confirmar que .env est√° completo
cat .env | grep -E "(SUPABASE|ASAAS|RESEND|JWT_SECRET)"
```

**Vari√°veis cr√≠ticas**:
- `NEXT_PUBLIC_SUPABASE_URL` ‚úÖ
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` ‚úÖ
- `SUPABASE_SERVICE_ROLE_KEY` ‚úÖ
- `ASAAS_API_KEY` ‚úÖ
- `RESEND_API_KEY` ‚úÖ
- `JWT_SECRET` ‚úÖ

---

## üåê PASSO 2: DEPLOY NA VERCEL

### 2.1 Instalar Vercel CLI
```bash
npm install -g vercel
vercel login
```

### 2.2 Configurar Projeto
```bash
# Inicializar projeto Vercel
vercel

# Responder perguntas:
# ? Set up and deploy "BDC FN"? [Y/n] Y
# ? Which scope? Sua conta
# ? Link to existing project? [y/N] N
# ? What's your project's name? bdc-classificados
# ? In which directory is your code located? ./
```

### 2.3 Configurar Vari√°veis de Ambiente na Vercel

**Via Dashboard** (https://vercel.com/seu-usuario/bdc-classificados/settings/environment-variables):

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xjguzxwwydlpvudwmiyv.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Sistema
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://www.buscaaquibdc.com
NEXT_PUBLIC_SITE_URL=https://www.buscaaquibdc.com
JWT_SECRET=bdc_jwt_super_secret_production_2024_maranhao

# Resend
RESEND_API_KEY=re_6ZQPbka7_AyzN2wnkpQjc5Y26CFdY3qFF
RESEND_FROM_EMAIL=noreply@buscaaquibdc.com

# Asaas
ASAAS_API_KEY=prod_000MzkwODA2MWY2OGM3MWRlMDU2NWM3MzJlNzZmNGZhZGY6OjNiZmZlNzcyLTZiZWEtNDhlNC05NjMxLTY0M2JkY2I5YjM3NTo6JGFhY2hfNTJiYjkzYjgtZDBhMi00ZjM0LWFmYjMtMmYzOWQ1NDY4MzE3
ASAAS_API_URL=https://api.asaas.com/v3
ASAAS_WEBHOOK_SECRET=bdc_webhook_secret_prod_2024_asaas_maranhao
```

**Via CLI**:
```bash
# Copiar do .env local
vercel env pull .env.production
vercel env add NEXT_PUBLIC_SUPABASE_URL production
vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY production
# ... repetir para todas as vari√°veis
```

### 2.4 Deploy para Produ√ß√£o
```bash
# Deploy de produ√ß√£o
vercel --prod

# Aguardar conclus√£o
# URL: https://bdc-classificados.vercel.app
```

---

## üîó PASSO 3: CONFIGURAR DOM√çNIO CUSTOMIZADO

### 3.1 Adicionar Dom√≠nio na Vercel
```bash
# Via CLI
vercel domains add www.buscaaquibdc.com

# Ou via Dashboard:
# https://vercel.com/seu-usuario/bdc-classificados/settings/domains
```

### 3.2 Configurar DNS

**No seu provedor de DNS** (ex: Registro.br, Cloudflare):

```dns
# Tipo  | Nome | Valor                    | TTL
A       | @    | 76.76.21.21             | 3600
CNAME   | www  | cname.vercel-dns.com    | 3600
```

**Alternativa (via CNAME)**:
```dns
CNAME | www  | bdc-classificados.vercel.app | 3600
```

### 3.3 Ativar HTTPS
Na Vercel, o SSL √© autom√°tico. Aguardar propaga√ß√£o (at√© 24h).

---

## üìß PASSO 4: CONFIGURAR WEBHOOKS

### 4.1 Webhook Asaas

**URL**: `https://www.buscaaquibdc.com/api/webhooks/asaas`

**Configurar no painel Asaas**:
1. Acessar: https://www.asaas.com/config/webhooks
2. Adicionar webhook:
   - URL: `https://www.buscaaquibdc.com/api/webhooks/asaas`
   - Eventos: `PAYMENT_RECEIVED`, `PAYMENT_CONFIRMED`, `PAYMENT_OVERDUE`
   - Vers√£o: v3
   - Token: (usar `ASAAS_WEBHOOK_SECRET`)

### 4.2 Testar Webhook
```bash
curl -X POST https://www.buscaaquibdc.com/api/webhooks/asaas \
  -H "Content-Type: application/json" \
  -H "asaas-access-token: $ASAAS_WEBHOOK_SECRET" \
  -d '{"event":"PAYMENT_RECEIVED","payment":{"id":"pay_test"}}'
```

**Resultado esperado**: `200 OK`

---

## üóÑÔ∏è PASSO 5: VALIDAR SUPABASE EM PRODU√á√ÉO

### 5.1 Verificar RLS Policies
```sql
-- Conectar ao Supabase SQL Editor
-- Verificar policies ativas
SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual
FROM pg_policies
WHERE schemaname = 'public';
```

**Resultado esperado**: Policies ativas em todas as tabelas sens√≠veis

### 5.2 Configurar Storage CORS
```bash
# No Supabase Dashboard > Storage > Configuration
# Adicionar dom√≠nio permitido:
https://www.buscaaquibdc.com
```

### 5.3 Verificar Buckets
Confirmar que os 9 buckets est√£o acess√≠veis:
- `avatars` (p√∫blico)
- `businesses` (p√∫blico)
- `ads` (p√∫blico)
- `highlights` (p√∫blico)
- `banners` (p√∫blico)
- `categories` (p√∫blico)
- `logos` (p√∫blico)
- `documents` (privado)
- `temp` (privado)

---

## üß™ PASSO 6: TESTES EM PRODU√á√ÉO

### 6.1 Testar Autentica√ß√£o
```bash
# Registrar novo usu√°rio
curl -X POST https://www.buscaaquibdc.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "teste@buscaaquibdc.com",
    "password": "senha123",
    "name": "Usuario Teste"
  }'

# Login
curl -X POST https://www.buscaaquibdc.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "teste@buscaaquibdc.com",
    "password": "senha123"
  }'
```

### 6.2 Testar Cria√ß√£o de An√∫ncio
```bash
# Com token obtido no login
curl -X POST https://www.buscaaquibdc.com/api/ads \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer SEU_TOKEN" \
  -d '{
    "title": "Teste de An√∫ncio",
    "description": "Descri√ß√£o teste",
    "category_id": "ID_CATEGORIA",
    "city_id": "ID_CIDADE",
    "price": 100
  }'
```

### 6.3 Testar Upload de Imagem
```bash
curl -X POST https://www.buscaaquibdc.com/api/upload \
  -H "Authorization: Bearer SEU_TOKEN" \
  -F "file=@imagem-teste.jpg" \
  -F "bucket=ads"
```

### 6.4 Checklist Manual
Testar navegando pelo site:
- [ ] P√°gina inicial carrega
- [ ] Lista de categorias aparece (75 categorias)
- [ ] Lista de cidades aparece (55 cidades)
- [ ] Registro de usu√°rio funciona
- [ ] Login funciona
- [ ] Criar an√∫ncio funciona
- [ ] Upload de imagens funciona
- [ ] Busca de an√∫ncios funciona
- [ ] Dashboard do usu√°rio funciona
- [ ] Planos de assinatura aparecem
- [ ] PWA install prompt aparece (mobile)

---

## üìä PASSO 7: MONITORAMENTO

### 7.1 Configurar Vercel Analytics
```bash
# J√° inclu√≠do no projeto Next.js
# Ativar no dashboard Vercel
```

### 7.2 Configurar Sentry (Recomendado)
```bash
npm install @sentry/nextjs

# Configurar .sentryrc
npx @sentry/wizard -i nextjs
```

### 7.3 Configurar Google Analytics
Adicionar em `app/layout.tsx`:
```typescript
import { GoogleAnalytics } from '@next/third-parties/google'

export default function RootLayout({ children }) {
  return (
    <html>
      <body>{children}</body>
      <GoogleAnalytics gaId="G-XXXXXXXXXX" />
    </html>
  )
}
```

### 7.4 Logs e Alertas
```bash
# Vercel CLI - Ver logs em tempo real
vercel logs --follow

# Ver logs de erro
vercel logs --filter error
```

---

## üîê PASSO 8: SEGURAN√áA P√ìS-DEPLOY

### 8.1 Verificar Headers de Seguran√ßa
```bash
curl -I https://www.buscaaquibdc.com
```

**Headers esperados**:
```
X-Frame-Options: DENY
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000
```

### 8.2 Testar Rate Limiting
Implementar no `middleware.ts`:
```typescript
// Adicionar rate limiting com upstash/ratelimit
import { Ratelimit } from "@upstash/ratelimit"
import { Redis } from "@upstash/redis"
```

### 8.3 Configurar WAF (Vercel Firewall)
No dashboard Vercel > Security:
- Ativar DDoS Protection
- Configurar rate limits
- Bloquear pa√≠ses suspeitos (se necess√°rio)

---

## üí∞ PASSO 9: CONFIGURAR PAGAMENTOS EM PRODU√á√ÉO

### 9.1 Validar Chave Asaas Produ√ß√£o
```bash
# Testar chave
curl https://api.asaas.com/v3/customers \
  -H "access_token: $ASAAS_API_KEY" \
  -H "Content-Type: application/json"
```

**Resultado esperado**: `200 OK` com lista de clientes

### 9.2 Criar Cliente Teste
```bash
node scripts/test-asaas-payment.js
```

### 9.3 Testar Fluxo de Pagamento Completo
1. Criar assinatura no site
2. Gerar PIX/Boleto
3. Confirmar pagamento no sandbox Asaas
4. Verificar webhook recebido
5. Confirmar atualiza√ß√£o de status no banco

---

## üì± PASSO 10: VALIDAR PWA

### 10.1 Testar Manifest
```bash
curl https://www.buscaaquibdc.com/manifest.json
```

### 10.2 Testar Service Worker
```bash
curl https://www.buscaaquibdc.com/sw.js
```

### 10.3 Validar PWA Criteria
Usar ferramenta: https://www.pwabuilder.com/

**Crit√©rios**:
- [x] Manifest v√°lido
- [x] Service worker registrado
- [x] HTTPS ativo
- [x] Icons em m√∫ltiplos tamanhos
- [x] Funciona offline (cache b√°sico)

---

## üéØ CHECKLIST FINAL DE PRODU√á√ÉO

### Infraestrutura ‚úÖ
- [ ] Build de produ√ß√£o executado com sucesso
- [ ] Deploy na Vercel conclu√≠do
- [ ] Dom√≠nio customizado configurado
- [ ] SSL/HTTPS ativo
- [ ] DNS propagado

### Integrations ‚úÖ
- [ ] Supabase conectado em produ√ß√£o
- [ ] Asaas webhooks configurados e testados
- [ ] Resend enviando emails
- [ ] Storage acess√≠vel e CORS configurado

### Funcionalidades ‚úÖ
- [ ] Autentica√ß√£o funcionando
- [ ] Cria√ß√£o de an√∫ncios OK
- [ ] Upload de imagens OK
- [ ] Busca funcionando
- [ ] Pagamentos testados
- [ ] Admin panel acess√≠vel

### Seguran√ßa ‚úÖ
- [ ] Headers de seguran√ßa configurados
- [ ] RLS policies ativas
- [ ] JWT secrets √∫nicos em produ√ß√£o
- [ ] Vari√°veis sens√≠veis n√£o expostas
- [ ] CORS configurado corretamente

### Performance ‚úÖ
- [ ] Bundle size < 90KB
- [ ] Imagens otimizadas
- [ ] Static generation funcionando
- [ ] Cache configurado

### Monitoramento ‚úÖ
- [ ] Analytics configurado
- [ ] Error tracking ativo (Sentry)
- [ ] Logs acess√≠veis (Vercel)
- [ ] Alertas configurados

---

## üÜò TROUBLESHOOTING

### Problema: Build falha na Vercel
**Solu√ß√£o**:
```bash
# Limpar cache local
rm -rf .next node_modules
npm install
npm run build

# Se funcionar local, fazer:
vercel --prod --force
```

### Problema: APIs retornam 500
**Causa comum**: Vari√°veis de ambiente n√£o configuradas

**Solu√ß√£o**:
```bash
# Verificar no Vercel Dashboard
vercel env ls

# Redeployar ap√≥s adicionar
vercel --prod
```

### Problema: Imagens n√£o carregam
**Causa comum**: CORS do Supabase Storage

**Solu√ß√£o**:
1. Acessar Supabase Dashboard
2. Storage > Configuration > CORS
3. Adicionar: `https://www.buscaaquibdc.com`

### Problema: Webhooks n√£o funcionam
**Verificar**:
```bash
# Testar endpoint manualmente
curl -X POST https://www.buscaaquibdc.com/api/webhooks/asaas \
  -H "Content-Type: application/json" \
  -d '{"event":"PAYMENT_RECEIVED"}'

# Ver logs
vercel logs | grep webhook
```

### Problema: JWT inv√°lido
**Causa**: JWT_SECRET diferente entre local e produ√ß√£o

**Solu√ß√£o**:
```bash
# Gerar novo secret √∫nico
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

# Atualizar na Vercel
vercel env add JWT_SECRET production
```

---

## üìû SUPORTE E CONTATOS

### Documenta√ß√£o
- [Next.js Docs](https://nextjs.org/docs)
- [Vercel Docs](https://vercel.com/docs)
- [Supabase Docs](https://supabase.com/docs)
- [Asaas API](https://docs.asaas.com)

### Logs √öteis
```bash
# Vercel logs
vercel logs --follow

# Logs de build
vercel logs --build

# Logs de erro
vercel logs --filter error --since 1h
```

### Status Services
- Vercel: https://vercel-status.com
- Supabase: https://status.supabase.com
- Asaas: https://status.asaas.com

---

## üéä P√ìS-DEPLOY

### Primeiras 24 Horas
- [ ] Monitorar logs constantemente
- [ ] Testar todos fluxos principais
- [ ] Verificar webhooks Asaas
- [ ] Confirmar emails sendo enviados
- [ ] Validar m√©tricas de performance

### Primeira Semana
- [ ] Analisar analytics
- [ ] Revisar logs de erro
- [ ] Otimizar queries lentas
- [ ] Ajustar cache se necess√°rio
- [ ] Coletar feedback de usu√°rios

### Primeiro M√™s
- [ ] Implementar melhorias baseadas em feedback
- [ ] Adicionar testes automatizados
- [ ] Configurar backups autom√°ticos do Supabase
- [ ] Revisar custos de infraestrutura
- [ ] Planejar pr√≥ximas features

---

## ‚úÖ CERTIFICA√á√ÉO DE DEPLOY

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                              ‚ïë
‚ïë                  GUIA DE DEPLOY COMPLETO                     ‚ïë
‚ïë                                                              ‚ïë
‚ïë              BDC CLASSIFICADOS - VERS√ÉO 1.0.0                ‚ïë
‚ïë                                                              ‚ïë
‚ïë  Este guia fornece instru√ß√µes passo-a-passo para            ‚ïë
‚ïë  realizar o deploy do sistema em ambiente de produ√ß√£o       ‚ïë
‚ïë  na plataforma Vercel.                                       ‚ïë
‚ïë                                                              ‚ïë
‚ïë  PONTOS-CHAVE:                                               ‚ïë
‚ïë  ‚Ä¢ Deploy via Vercel CLI ou GitHub                          ‚ïë
‚ïë  ‚Ä¢ Configura√ß√£o completa de vari√°veis de ambiente           ‚ïë
‚ïë  ‚Ä¢ Setup de webhooks Asaas                                   ‚ïë
‚ïë  ‚Ä¢ Valida√ß√£o de seguran√ßa e performance                     ‚ïë
‚ïë  ‚Ä¢ Monitoramento e troubleshooting                          ‚ïë
‚ïë                                                              ‚ïë
‚ïë  PREPARADO POR: Claude Code AI Assistant                    ‚ïë
‚ïë  DATA: 02 de Janeiro de 2025                                ‚ïë
‚ïë                                                              ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

**Documento criado automaticamente baseado na certifica√ß√£o de valida√ß√£o t√©cnica completa**

*Para quest√µes t√©cnicas, consulte CERTIFICADO_VALIDACAO_FINAL.md*
